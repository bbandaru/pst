<script src="/gen/renderer.js"></script>

<polymer-element name="pst-renderer" attributes="shader">
  <template>
    <style>
      @host { * { display: block; } }
      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
    <canvas id="canvas"></canvas>
  </template>
  <script>
    Polymer('pst-renderer', {
      shader: '',
      created: function() {
        var PstRenderer = require('./renderer/index.js');
        var renderer = this.renderer = new PstRenderer();

        var self = this;

        // Repeat events as DOM events.
        var events = ['compile', 'error'];
        events.forEach(function(name) {
          renderer.on(name, self.fire.bind(self, name));
        });

        renderer.canvas = this.$.canvas;
        renderer.configure({
          textureBaseUrl: '/img'
        });
        renderer.init();

        function step() {
          requestAnimationFrame(step);
          renderer.step();
        }
        requestAnimationFrame(step);
      },
      shaderChanged: function() {
        this.renderer.shader = this.shader;
      }
    });
  </script>
</polymer-element>
